<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Identitours</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      color: #333;
    }
    #startScreen, #canvas {
      padding: 2em;
      text-align: center;
    }
    #button {
      margin: 0.5em 1em;
      padding: 0.5em 1em;
      font-size: 1em;
    }
    #canvas {
      position: relative;
      height: 100vh;
      background: #fff;
      overflow: hidden;
    }
    .point {
      position: absolute;
      width: 20px;
      height: 20px;
      background-color: #888;
      border-radius: 50%;
      transition: background-color 0.3s, transform 0.3s;
      cursor: pointer;
    }
    .point.transformation-active {
      background-color: red;
      transform: scale(2);
    }
    .point.definition-active {
      background-color: black;
      transform: scale(2);
    }
    .point-label {
      position: absolute;
      font-size: 0.9em;
      transform: translate(-50%, -50%);
      white-space: nowrap;
    }

@media (max-width: 600px) {
    #controls {
        flex-direction: column;
        align-items: center;
        gap: 1em;
        bottom: 5%;
        left: 50%;
        transform: translateX(-50%);
    }
  }
    
  </style>
</head>
<body>
  <div id="startScreen">
    <h1>Identitours</h1>
    <p>
      The journey starts from the definition: Words set perimeters, bridge rivers, carve new paths.
      The map leads to wondrous and sometimes fantastical transformations in the garden of Buitenplaats Brienenoord:
      Masks â€” expressions of virtuality, of possibility as a reality, built with everyday means. Audio pieces guide you
      through my personal, evolving relationship with labels and exhibit the ways in which I reject, reclaim or reinterpret words.
      There is something shared in the personal. Your walk between points and toggling between definition and personal semantic shift is a performative manifestation of (inner) dialogue,
      the space where meaning and identity are negotiated. <br><br><br>INSTRUCTIONS: Walk around, in a walk that represents the journey towards changing meaning, and find the masks, my temporary stops in the negotiation of identity. Toggle between the dictionary definition of a label and my interpretation. 
    </p>
    <button id="startButton">Start the Walk</button>
  </div>

  <div id="canvas" style="display: none;">
    <div id="point1" class="point" style="top: 30%; left: 20%;"><span class="point-label">Smart</span></div>
    <div id="point2" class="point" style="top: 20%; left: 35%;"><span class="point-label">Complicated</span></div>
    <div id="point3" class="point" style="top: 15%; left: 50%;"><span class="point-label">Naive</span></div>
    <div id="point4" class="point" style="top: 20%; left: 65%;"><span class="point-label">Crazy</span></div>
    <div id="point5" class="point" style="top: 30%; left: 80%;"><span class="point-label">Caring</span></div>
    <div id="point6" class="point" style="top: 50%; left: 80%;"><span class="point-label">Wild</span></div>
    <div id="point7" class="point" style="top: 70%; left: 65%;"><span class="point-label">Stubborn</span></div>
    <div id="point8" class="point" style="top: 70%; left: 35%;"><span class="point-label">Strong</span></div>

    <div id="controls" style="display: flex; justify-content: center; gap: 3em; position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%);">
  <div class="control-pair" style="display: flex; flex-direction: column; align-items: center;">
    <label for="mixButton" style="margin-bottom: 0.3em; font-weight: bold;">Mix:</label>
    <button id="mixButton">OFF</button>
  </div>

  <div class="control-pair" style="display: flex; flex-direction: column; align-items: center;">
    <label for="toggleMasksButton" style="margin-bottom: 0.3em; font-weight: bold;">Toggle Masks:</label>
    <button id="toggleMasksButton">Definition</button>
  </div>

  <div class="control-pair" style="display: flex; flex-direction: column; align-items: center;">
    <label for="soundButton" style="margin-bottom: 0.3em; font-weight: bold;">Sound:</label>
    <button id="soundButton">ON</button>

    <canvas id="lines" style="position:absolute; top:0; left:0; z-index:-1;"></canvas>
  </div>
</div>

  <audio id="startAudio" src="audio/start.mp3"></audio>
  <audio id="completeAudio" src="audio/complete.mp3"></audio>

  <audio id="audio1" src="audio/smart.mp3"></audio>
  <audio id="audio2" src="audio/complicated.mp3"></audio>
  <audio id="audio3" src="audio/naive.mp3"></audio>
  <audio id="audio4" src="audio/crazy.mp3"></audio>
  <audio id="audio5" src="audio/caring.mp3"></audio>
  <audio id="audio6" src="audio/wild.mp3"></audio>
  <audio id="audio7" src="audio/stubborn.mp3"></audio>
  <audio id="audio8" src="audio/strong.mp3"></audio>

  <audio id="definition1" src="audio/smart_Now.mp3"></audio>
  <audio id="definition2" src="audio/complicated_Now.mp3"></audio>
  <audio id="definition3" src="audio/naive_Now.mp3"></audio>
  <audio id="definition4" src="audio/crazy_Now.mp3"></audio>
  <audio id="definition5" src="audio/caring_Now.mp3"></audio>
  <audio id="definition6" src="audio/wild_Now.mp3"></audio>
  <audio id="definition7" src="audio/stubborn_Now.mp3"></audio>
  <audio id="definition8" src="audio/strong_Now.mp3"></audio>

  <script>
  let isMixMode = false;
  let isDefinitionMode = true;
  let isSoundOn = true;
  let geolocationStarted = false;
  let startAudio = document.getElementById('startAudio');
  const playedGeoPoints = new Set();

  const mixButton = document.getElementById('mixButton');
  const toggleMasksButton = document.getElementById('toggleMasksButton');
  const soundButton = document.getElementById('soundButton');

  mixButton.addEventListener('click', () => {
    isMixMode = !isMixMode;
    mixButton.textContent = isMixMode ? 'ON' : 'OFF';
  });

  toggleMasksButton.addEventListener('click', () => {
    isDefinitionMode = !isDefinitionMode;
    toggleMasksButton.textContent = isDefinitionMode ? 'Definition' : 'Semantic Shift';
  });

  soundButton.addEventListener('click', () => {
    isSoundOn = !isSoundOn;
    soundButton.textContent = isSoundOn ? 'ON' : 'OFF';

    if (!isSoundOn) {
      document.querySelectorAll('audio').forEach(audio => audio.pause());
    }

    document.querySelectorAll('#canvas button').forEach(btn => {
      if (btn !== soundButton) {
        btn.style.opacity = isSoundOn ? '1' : '0.5';
        btn.disabled = !isSoundOn;
      }
    });
  });

  function initPointListeners() {
    for (let i = 1; i <= 8; i++) {
      const point = document.getElementById('point' + i);
      if (point) {
        point.addEventListener('click', () => {
          autoReactivateSound();
          const audioId = isDefinitionMode ? 'definition' + i : 'audio' + i;
          const audio = document.getElementById(audioId);

          if (audio && isSoundOn) {
            if (!isMixMode) stopAllAudio();
            document.querySelectorAll('.point').forEach(p => p.classList.remove('definition-active', 'transformation-active'));
            audio.play();
            point.classList.add(isDefinitionMode ? 'definition-active' : 'transformation-active');
            checkAllPointsActivated();
          }
        });
      }
    }
  }

  document.getElementById('startButton').addEventListener('click', () => {
    if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
      const audioCtx = new (AudioContext || webkitAudioContext)();
      if (audioCtx.state === 'suspended') {
        audioCtx.resume().then(() => {
          console.log('AudioContext resumed');
        });
      }
    }

    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('canvas').style.display = 'block';

    if (startAudio) {
      startAudio.load();
      startAudio.play().catch(err => {
        console.error("Start audio could not be played:", err);
      });
    }
  });

  function initGeolocation() {
    if (geolocationStarted) return;
    geolocationStarted = true;
    console.log("Geolocation started.");

    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(position => {
        const { latitude, longitude } = position.coords;

        geoPoints.forEach(point => {
          const latDiff = (latitude - point.lat) * 111000;
          const lonDiff = (longitude - point.lon) * 111000 * Math.cos(latitude * Math.PI / 180);
          const dist = Math.sqrt(latDiff * latDiff + lonDiff * lonDiff);

          if (dist < point.radius) {
            const audio = document.getElementById(point.audioId);
            const domPoint = document.getElementById(point.pointId);

            if (audio && domPoint && audio.paused && !playedGeoPoints.has(point.audioId)) {
              if (!isMixMode) {
                geoPoints.forEach(other => {
                  if (other.audioId !== point.audioId) {
                    const otherAudio = document.getElementById(other.audioId);
                    if (otherAudio) {
                      otherAudio.pause();
                      otherAudio.currentTime = 0;
                    }
                  }
                });
              }

              autoReactivateSound();
              audio.play();
              domPoint.classList.add('transformation-active');
              checkAllPointsActivated();
              playedGeoPoints.add(point.audioId);

              audio.onended = () => {
                playedGeoPoints.delete(point.audioId);
                domPoint.classList.remove('transformation-active');
              };
            }
          }
        });
      }, error => {
        console.error('Geolocation error:', error.message);
        alert("Geolocation error: " + error.message);
      }, { enableHighAccuracy: true });
    } else {
      alert("Geolocation is not supported by this browser.");
    }
  }

  if (startAudio) {
    startAudio.load();

    startAudio.onended = () => {
      console.log("Start audio finished.");
      initGeolocation();
    };

    startAudio.onerror = () => {
      console.log("Start audio error.");
      initGeolocation();
    };

    const originalPause = startAudio.pause;
    startAudio.pause = function () {
      if (!geolocationStarted && !startAudio.ended) {
        console.log("Start audio manually stopped.");
        initGeolocation();
      }
      originalPause.call(this);
    };
  }

  function stopAllAudio() {
    isMixMode = false;
    mixButton.textContent = 'OFF';
    document.querySelectorAll('audio').forEach(audio => {
      audio.pause();
      audio.currentTime = 0;
    });
  }

  function autoReactivateSound() {
    if (!isSoundOn) {
      isSoundOn = true;
      soundButton.textContent = 'ON';
      document.querySelectorAll('#canvas button').forEach(btn => {
        if (btn !== soundButton) {
          btn.style.opacity = '1';
          btn.disabled = false;
        }
      });
    }
  }

  function checkAllPointsActivated() {
    const allActive = [...document.querySelectorAll('.point')].every(p =>
      p.classList.contains('transformation-active') || p.classList.contains('definition-active')
    );

    if (allActive) {
      const completeAudio = document.getElementById('completeAudio');
      if (completeAudio) completeAudio.play();
      document.querySelectorAll('.point').forEach(p => p.style.pointerEvents = 'none');
    }
  }

  window.addEventListener('load', () => {
    initPointListeners();
    const geoAudioIds = ['audio1','audio2','audio3','audio4','audio5','audio6','audio7','audio8'];
    geoAudioIds.forEach(id => {
      const audio = document.getElementById(id);
      if (audio) {
        audio.load();
        audio.play().then(() => {
          audio.pause();
          audio.currentTime = 0;
        }).catch(err => {
          console.error(`Failed to pre-play audio "${id}":`, err);
        });
      }
    });
  });

  const geoPoints = [
    { lat: 52.09025, lon: 4.27061, radius: 3, audioId: 'audio1', pointId: 'point1' },
    { lat: 52.09029, lon: 4.27034, radius: 3, audioId: 'audio2', pointId: 'point2' },
    { lat: 52.09032, lon: 4.27005, radius: 3, audioId: 'audio3', pointId: 'point3' },
    { lat: 52.09031, lon: 4.26976, radius: 3, audioId: 'audio4', pointId: 'point4' },
    { lat: 52.09031, lon: 4.26941, radius: 3, audioId: 'audio5', pointId: 'point5' },
    { lat: 52.09027, lon: 4.26919, radius: 3, audioId: 'audio6', pointId: 'point6' },
    { lat: 52.09027, lon: 4.26884, radius: 3, audioId: 'audio7', pointId: 'point7' },
    { lat: 52.09023, lon: 4.26856, radius: 3, audioId: 'audio8', pointId: 'point8' }
  ];
</script>
</body>
</html>
